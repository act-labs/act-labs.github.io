(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{715:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(14),s=a.n(r),i=a(15),c=a.n(i),l=a(1),u=function(e){function t(t){var a;return(a=e.call(this,t)||this).layout=null,a}return c()(t,e),t.prototype.render=function(){var e=this.props,t=e.components;s()(e,["components"]);return o.a.createElement(l.MDXTag,{name:"wrapper",components:t},o.a.createElement(l.MDXTag,{name:"p",components:t},"If you ",o.a.createElement(l.MDXTag,{name:"a",components:t,parentName:"p",props:{href:"/posts/airflow-gke/",title:"Installing Airflow on GKE"}},"just installed")," Airflow on GKE, it is time to check it is working and we are able to communicate with different Google Cloud Components, including Google Cloud Storage and Google Pub/Sub."),o.a.createElement(l.MDXTag,{name:"h1",components:t},"An Airflow REST API"),o.a.createElement(l.MDXTag,{name:"p",components:t},"After installation, one may wish to visit an Airflow web UI and check that application is working. So far, we have not configured networking/load balancing (which is really a subject in its own), so the easiest way to access web UI is to use port forwarding:"),o.a.createElement(l.MDXTag,{name:"pre",components:t},o.a.createElement(l.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-sh"}},"kubectl port-forward pod/web-0 8080:8080\n")),o.a.createElement(l.MDXTag,{name:"p",components:t},"Now we may check Airflow state and run our DAGs manually or using Airflow API endpoints:"),o.a.createElement(l.MDXTag,{name:"pre",components:t},o.a.createElement(l.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-sh"}},'# test Airflow webserver is running\ncurl localhost:8080/api/experimental/test\n{"status":"OK"}\n# Start DAG with <DAG_ID>\ncurl -X POST http://localhost:8080/api/experimental/dags/<DAG_ID>/dag_runs     -H \'Cache-Control: no-cache\'     -H \'Content-Type: application/json\'     -d \'{"conf":"{"key":"value"}"}\'\n')),o.a.createElement(l.MDXTag,{name:"p",components:t},"By default, upon creation, DAGs are paused, so you may need to enable DAGs manually or set configuration parameter ",o.a.createElement(l.MDXTag,{name:"inlineCode",components:t,parentName:"p"},"dags_are_paused_at_creation")," to False."),o.a.createElement(l.MDXTag,{name:"h1",components:t},"Google Cloud Storage: simple storage using GoogleCloudStorageHook"),o.a.createElement(l.MDXTag,{name:"p",components:t},"We have already configured access to Cloud SQL, so we may query data from SQL databases. Another useful possibility is the ability to save data in Google cloud storage. Airflow comes with many helpers, simplifying access to different services, including GCS. To test cloud storage, lets create GCS buckets using command line ",o.a.createElement(l.MDXTag,{name:"inlineCode",components:t,parentName:"p"},"gsutil")," utility (as bucket names must be globally unique you may need to change bucket names):"),o.a.createElement(l.MDXTag,{name:"pre",components:t},o.a.createElement(l.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-sh"}},"gsutil mb gs://airflow-test-source\ngsutil mb gs://airflow-test-dest\n")),o.a.createElement(l.MDXTag,{name:"p",components:t},"Now, using ",o.a.createElement(l.MDXTag,{name:"inlineCode",components:t,parentName:"p"},"GoogleCloudStorageHook")," we may test simple storage operations. During our test drive, we save file to bucket, copy it to another\nbucket, and finally download it on a local disk:"),o.a.createElement(l.MDXTag,{name:"pre",components:t},o.a.createElement(l.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-python"}},"from airflow import DAG\nfrom airflow.operators.python_operator import PythonOperator\nfrom airflow.contrib.hooks.gcs_hook import GoogleCloudStorageHook\nimport json\nfrom datetime import datetime\n\nFILE_NAME = f'./test.json'\nDOWNLOAD_NAME = f'./downloaded.json'\n\ndef save_data():\n    with open(FILE_NAME, 'w') as f:\n        json.dump({\"name\":\"name\", \"age\":10}, f)\n\ndef upload_file_func():\n    save_data()\n    hook = GoogleCloudStorageHook()\n    source_bucket = 'airflow-test-source'\n    source_object = '/data/test.json'\n    hook.upload(source_bucket, source_object, FILE_NAME)\n\ndef copy_file_func():\n    hook = GoogleCloudStorageHook()\n    source_bucket = 'airflow-test-source'\n    source_object = '/data/test.json'\n\n    dest_bucket = 'airflow-test-dest'\n    dest_object = 'test.json'\n    hook.copy(source_bucket, source_object, dest_bucket, dest_object)\n\ndef download_file_func():\n    hook = GoogleCloudStorageHook()\n    dest_bucket = 'airflow-test-dest'\n    dest_object = 'test.json'\n    hook.download(dest_bucket, dest_object, DOWNLOAD_NAME)\n    with open(DOWNLOAD_NAME) as json_file:\n        data = json.load(json_file)\n    print(data)\n\nwith DAG('gcs_examples', description='DAG', schedule_interval=None, start_date=datetime(2018, 11, 1)) as dag:\n    upload_file = PythonOperator(task_id='upload_file', python_callable=upload_file_func)\n    copy_file   = PythonOperator(task_id='copy_file', python_callable=copy_file_func)\n    download_file = PythonOperator(task_id='download_file', python_callable=download_file_func)\n    upload_file >> copy_file >> download_file\n")),o.a.createElement(l.MDXTag,{name:"p",components:t},"Up to this point we have learned how to schedule our Airflow tasks, invoke them on demand, query data and save results after some data processing. The only missing piece is the ability to send notifications. We could do it using conventional HTTP requests, but on GCP we have an additional option: Cloud Pub/Sub. To test it, we may first create topic and publish/subscribe manually:"),o.a.createElement(l.MDXTag,{name:"pre",components:t},o.a.createElement(l.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-sh"}},'# create topic and subscription\ngcloud pubsub topics create my-topic\ngcloud pubsub subscriptions create my-sub --topic=my-topic\n# publish receive\ngcloud pubsub topics publish my-topic --message="hello"\ngcloud pubsub subscriptions pull my-sub --auto-ack\n')),o.a.createElement(l.MDXTag,{name:"p",components:t},"After which we may publish notification in our DAGs using ",o.a.createElement(l.MDXTag,{name:"inlineCode",components:t,parentName:"p"},"PubSubHook"),":"),o.a.createElement(l.MDXTag,{name:"pre",components:t},o.a.createElement(l.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-python"}},'from airflow.contrib.hooks.gcp_pubsub_hook import PubSubHook\nfrom base64 import b64encode as b64e\n\nhook = PubSubHook()\n\nhook.publish("google_project_id", "my-topic", [{"data": b64e("hello".encode()).decode(), \'attributes\': {\'type\': \'greeting\'}  }])\n')),o.a.createElement(l.MDXTag,{name:"h1",components:t},"Summary"),o.a.createElement(l.MDXTag,{name:"p",components:t},"After installation to Google Kubernetes Engine, we checked our installation is working and tested two Google services: Google Cloud Storage and Google Cloud Pub/Sub. Now we are able to schedule our workflows, invoke them on demand, query and save processed data and notify other systems upon completion. With such a tooling under our belt we may start working on some serious ETL problems! The source code and installation scripts used in this project could be found on ",o.a.createElement(l.MDXTag,{name:"a",components:t,parentName:"p",props:{href:"https://github.com/act-labs/airflow-gke",title:"Apache Airflow setup on GKE"}},"GitHub"),".\n"))},t}(o.a.Component),m=a(757);function p(e){return o.a.createElement(m.a,e,o.a.createElement(u,e))}a.d(t,"default",function(){return p})},737:function(e,t,a){"use strict";a(46);var n=a(738),o=a(0),r=a.n(o),s=a(2),i=a.n(s),c=a(748),l=a.n(c),u=a(34);function m(e){var t=e.description,a=e.lang,o=e.meta,s=e.keywords,i=e.title;return r.a.createElement(u.b,{query:p,render:function(e){return"string"==typeof s&&(s=s.split(",").map(function(e){return e.trim()})),t=t||e.site.siteMetadata.description,r.a.createElement(l.a,{htmlAttributes:{lang:a},title:i,titleTemplate:"%s | "+e.site.siteMetadata.project,meta:[{name:"description",content:t},{property:"og:title",content:i},{property:"og:description",content:t},{property:"og:type",content:"website"},{name:"twitter:card",content:"summary"},{name:"twitter:creator",content:e.site.siteMetadata.author},{name:"twitter:title",content:i},{name:"twitter:description",content:t}].concat(s?{name:"keywords",content:s.join(", ")}:[]).concat(o)})},data:n})}m.defaultProps={lang:"en",meta:[],keywords:null},m.propTypes={description:i.a.string,lang:i.a.string,meta:i.a.array,keywords:i.a.oneOfType([i.a.string,i.a.arrayOf(i.a.string)]),title:i.a.string.isRequired},t.a=m;var p="304502870"},738:function(e){e.exports={data:{site:{siteMetadata:{project:"ACT blog",description:"React, Ant Design, Gatsby, GraphQl, and other web technologies",author:"Act Labs"}}}}},739:function(e,t,a){"use strict";a.d(t,"a",function(){return l});a(352);var n=a(740),o=a(0),r=a.n(o),s=a(34),i=a(231),c=a.n(i);function l(){return r.a.createElement(s.b,{query:"2369744027",render:function(e){return r.a.createElement(c.a,{fixed:e.logo.childImageSharp.fixed,style:{float:"left"}})},data:n})}},740:function(e){e.exports={data:{logo:{childImageSharp:{fixed:{base64:"data:image/png;base64,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",width:50,height:60,src:"/static/a64620346ac3ce8d4580a3f07039fa3c/8469d/logo.png",srcSet:"/static/a64620346ac3ce8d4580a3f07039fa3c/8469d/logo.png 1x"}}}}}},741:function(e){e.exports={data:{config:{copyright:"Copyright © Act Labs",social:[{icon:"facebook",link:"https://www.facebook.com/ACT7LAB"},{icon:"github",link:"https://github.com/act-labs/gatsby-starter-act-blog"}]}}}},742:function(e){e.exports={data:{config:{nav:[{text:"home",slug:null},{text:"posts",slug:"/posts/"},{text:"snippets",slug:"/snippets/"}]}}}},743:function(e,t,a){"use strict";a(6);var n=a(138),o=(a(178),a(31)),r=a.n(o),s=(a(749),a(735),a(736)),i=a.n(s),c=a(741),l=a(0),u=a.n(l),m=a(34),p=i.a.Footer;function d(e){var t=e.social,a=e.copyright,o=t.map(function(e){var t=e.link,a=e.icon;return u.a.createElement(n.a,{key:a,to:t},u.a.createElement(r.a,{type:a,style:{fontSize:"24px",marginLeft:10,color:"rgba(0, 0, 0, 0.65)"}}))});return u.a.createElement(p,{style:{textAlign:"center"}},u.a.createElement("div",null,a,u.a.createElement("div",{style:{float:"right"}},o)))}function g(e){return e.social?u.a.createElement(d,e):u.a.createElement(m.b,{query:"2743462859",render:function(t){var a=t.config,n=a.social,o=a.copyright;return u.a.createElement(d,Object.assign({social:n,copyright:o},e))},data:c})}a(747);var f=a(746),h=a.n(f),b=a(739),y=a(742),w=i.a.Header;function E(e){var t=e.nav;return u.a.createElement(w,{className:"navigation-bar"},u.a.createElement(n.a,{to:"/"},u.a.createElement(b.a,null)),u.a.createElement(h.a,{theme:"dark",mode:"horizontal",defaultSelectedKeys:t.filter(function(e){return e.selected}).map(function(e){return e.text}),style:{lineHeight:"64px"}},t.map(function(e,t){var a=e.slug,o=e.text;return u.a.createElement(h.a.Item,{key:t},u.a.createElement(n.a,{to:a||"/"},o))})))}function k(e){return e.nav?u.a.createElement(E,e):u.a.createElement(m.b,{query:"1250442554",render:function(t){var a=t.config.nav;return u.a.createElement(E,Object.assign({nav:a},e))},data:y})}var A=a(737),v=a(14),D=a.n(v);a(671);a.d(t,"a",function(){return X});var M=i.a.Content,T=i.a.Sider;function N(e){var t=e.style,a=e.children,n=D()(e,["style","children"]);return u.a.createElement(M,Object.assign({style:Object.assign({padding:"5px 24px"},t)},n),a)}function X(e){var t=e.children,a=e.className,n=e.title,o=e.description,r=e.keywords,s=e.style,c=e.layout,l=Object.assign({},_,c),m=l.footer,p=l.fullHeight,d=Object.assign({},p?{height:"100%"}:null,s),f=(a?a+" ":"")+"page-layout";return u.a.createElement(i.a,{className:f,style:d},u.a.createElement(A.a,{title:n,keywords:r,description:o}),u.a.createElement(k,null),t,m?u.a.createElement(g,null):null)}var _={footer:!0};X.Panel=N,X.SideMenuPanel=function(e){var t=e.children,a=e.menu;return u.a.createElement(i.a,{style:{padding:"1em 0",background:"#fff",minHeight:1e3}},u.a.createElement(T,{width:200},a),u.a.createElement(N,null,t))}},745:function(e,t,a){"use strict";a(6);var n=a(138),o=(a(46),a(0)),r=a.n(o),s=a(891),i=a(751),c=a(752),l=a(753),u=a(754),m=a(755),p=a(756);s.a.registerLanguage("javascript",i.a),s.a.registerLanguage("sh",c.a),s.a.registerLanguage("markdown",l.a),s.a.registerLanguage("yaml",u.a),s.a.registerLanguage("dockerfile",m.a);var d=a(1);a.d(t,"a",function(){return f});var g={components:{code:function(e){var t="bash";if(e.className){var a=e.className.split("-");a.length>1&&(t=a[1])}return r.a.createElement(s.a,{language:t,style:p.github},e.children)},a:n.a}};function f(e){var t=Object.assign({},g,e),a=t.components,n=t.children;return r.a.createElement(d.MDXProvider,{components:a},n)}},757:function(e,t,a){"use strict";a.d(t,"a",function(){return c});var n=a(745),o=(a(6),a(743)),r=a(0),s=a.n(r),i=(a(672),o.a.Panel);function c(e){var t=e.children,a=e.pageContext,r=Object.assign({frontmatter:{}},a),c=Object.assign({},{layout:r.layout},r.frontmatter);return s.a.createElement(o.a,c,s.a.createElement(i,{style:{paddingTop:"1em"}},c.title?s.a.createElement("h1",null,c.title):null,s.a.createElement(n.a,null,t)))}}}]);
//# sourceMappingURL=component---src-generated-posts-airflow-gke-getting-started-js-78b60f9c75642a3af4bb.js.map