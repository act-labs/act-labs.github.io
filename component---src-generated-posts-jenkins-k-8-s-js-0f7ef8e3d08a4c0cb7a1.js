(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{726:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),i=t(14),o=t.n(i),s=t(15),l=t.n(s),c=t(1),m=function(e){function n(n){var t;return(t=e.call(this,n)||this).layout=null,t}return l()(n,e),n.prototype.render=function(){var e=this.props,n=e.components;o()(e,["components"]);return r.a.createElement(c.MDXTag,{name:"wrapper",components:n},r.a.createElement(c.MDXTag,{name:"p",components:n},"Deploying Jenkins CI/CD pipelines to Kubernetes cluster has many advantages: build system easily scales up and down, it is easy to run tasks in parallel, you can easily use custom docker images for Jenkins slaves, etc. This is especially attractive for Cloud Native applications, as both Jenkins pipelines and application start using the same set of technologies. To illustrate the simplicity and power of such a setup, a simple Jenkins pipeline deploying Kubernetes applications with the help of Helm is considered."),r.a.createElement(c.MDXTag,{name:"h2",components:n},"Jenkins installation"),r.a.createElement(c.MDXTag,{name:"p",components:n},"To install Jenkins on Kubernetes, one must refer to instructions of particular cloud provider. For installation to GKE (Google Cloud Kubernetes) there is a Helm chart which installs Jenkins along with GKE plugin providing additional functionality (easy Docker builds, simplified access to Google cloud storage, cross-cluster deployments, etc). To use ",r.a.createElement(c.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"kubectl")," and Helm after installation, only one additional step could required: create additional Kubernetes service-account and bind it to ",r.a.createElement(c.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"cluster-admin")," role:"),r.a.createElement(c.MDXTag,{name:"pre",components:n},r.a.createElement(c.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-sh"}},"# Create service account:\nkubectl create serviceaccount helm\n# And bind it to the cluster-admin cluster role so that it can make changes:\nkubectl create clusterrolebinding helm-admin-binding --clusterrole=cluster-admin --serviceaccount=kube-system:helm\n")),r.a.createElement(c.MDXTag,{name:"h2",components:n},"Deployment using Helm"),r.a.createElement(c.MDXTag,{name:"p",components:n},"After installation, one may deploy applications using ",r.a.createElement(c.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"kubectl")," and Helm pretty easily:"),r.a.createElement(c.MDXTag,{name:"pre",components:n},r.a.createElement(c.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-sh"}},'    stages {\n        stage("deploy") {\n            agent {\n                kubernetes {\n                    cloud \'kubernetes\'\n                    label \'cd\'\n                    yamlFile \'jenkins/python-cd.yaml\'\n                }\n            }\n\n            steps {\n                container(\'cd\') {\n                    dir("helm") {\n                        sh "echo \'Simple kubectl install!\'"\n                        sh "curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl"\n                        sh "chmod +x ./kubectl"\n                        sh "mv ./kubectl /usr/local/bin/kubectl"\n\n                        sh "echo \'Simple helm install!\'"\n                        sh "wget https://get.helm.sh/helm-v3.2.4-linux-amd64.tar.gz"\n                        sh "tar zxfv helm-v3.2.4-linux-amd64.tar.gz"\n                        sh "cp linux-amd64/helm ."\n\n                        sh "echo \'upgrade app!\'"\n                        sh "./helm upgrade --install --wait app ./app"\n                    }\n                }\n            }\n        }\n    }\n')),r.a.createElement(c.MDXTag,{name:"p",components:n},"Here, for deployment, a separate Docker image was used (pod configuration is in ",r.a.createElement(c.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"jenkins/python-cd.yaml"),"). A ",r.a.createElement(c.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"kubectl")," and Helm are installed first, but later they could be moved into Docker image. After installation, application could be deployed using ",r.a.createElement(c.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"helm upgrade --install --wait app ./app")," command. Additionally cluster could be configured using ",r.a.createElement(c.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"kubectl")," commands. But in a nutshell, this is really only a few lines of code!"),r.a.createElement(c.MDXTag,{name:"p",components:n},"Helm command may fail if default service account doesn't provide enough privileges. To be able to use Helm and ",r.a.createElement(c.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"kubectl"),", just run Jenkins slave pod using previously created service account ",r.a.createElement(c.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"helm"),":"),r.a.createElement(c.MDXTag,{name:"pre",components:n},r.a.createElement(c.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-yaml"}},'apiVersion: v1\nkind: Pod\nmetadata:\n  name: python-cd\n  labels:\n    app: app-cd\nspec:\n  serviceAccountName: helm\n  containers:\n  - image: python\n    command:\n      - sleep\n      - "3600"\n    imagePullPolicy: IfNotPresent\n    name: cd\n  restartPolicy: Always\n')),r.a.createElement(c.MDXTag,{name:"p",components:n},"In the Jenkins pipeline above, application is deployed under the assumption that application Docker image has been built elsewhere. In real production pipeline, Docker image most likely will be created in the same Jenkinsfile. When running cluster in GKE, you can take advantage of Jenkins GKE plugin, saving the last snapshot of application in GCS bucket and building Docker image using Kaniko:"),r.a.createElement(c.MDXTag,{name:"pre",components:n},r.a.createElement(c.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-sh"}},"stage(\"Build\") {\n    agent {\n        kubernetes {\n            cloud 'kubernetes'\n            label 'python-cd'\n            yamlFile 'jenkins/python-cd.yaml'\n        }\n    }\n    steps {\n        container('python') {\n            dir(\"webapp\") {\n                // archive the build context for kaniko\n                sh \"tar -zcvf /tmp/$BUILD_CONTEXT .\"\n                step([$class: 'ClassicUploadStep',\n                credentialsId: env.JENK_INT_IT_CRED_ID,\n                bucket: \"gs://${BUILD_CONTEXT_BUCKET}\",\n                pattern: env.BUILD_CONTEXT])\n            }\n        }\n    }\n}\nstage(\"Publish Image\") {\n    agent {\n        kubernetes {\n            cloud 'kubernetes'\n            label 'kaniko-pod'\n            yamlFile 'jenkins/kaniko-pod.yaml'\n        }\n    }\n\n    environment {\n        PATH = \"/busybox:/kaniko:$PATH\"\n    }\n    steps {\n        container(name: 'kaniko', shell: '/busybox/sh') {\n            dir(\"webapp\") {\n                sh '''#!/busybox/sh\n                /kaniko/executor -f `pwd`/Dockerfile -c `pwd` --context=\"gs://${BUILD_CONTEXT_BUCKET}/${BUILD_CONTEXT}\" --destination=\"${GCR_IMAGE}\"\n                '''\n            }\n        }\n    }\n}\n")),r.a.createElement(c.MDXTag,{name:"p",components:n},"As all Jenkins pipeline steps take place in ordinary Docker image, they could be easily tested/debugged on developers' desktops or in the cluster using ",r.a.createElement(c.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"kubectl exec -it <pod> -- /bin/bash")," command."),r.a.createElement(c.MDXTag,{name:"h2",components:n},"Summary"),r.a.createElement(c.MDXTag,{name:"p",components:n},"Kubernetes application deployment using Jenkins, Docker containers and Helm is conceptually quite easy. Of course in real life production environment one may also wish to use namespaces or even separate clusters, may give some consideration to the security, etc. To play with the pipeline further, refer to ",r.a.createElement(c.MDXTag,{name:"a",components:n,parentName:"p",props:{href:"https://github.com/act-labs/jenkins-helm",title:"Jenkins pipeline to deploy Kubernetes applications using Helm 3"}},"source code")," on Github."))},n}(r.a.Component),p=t(756);function u(e){return r.a.createElement(p.a,e,r.a.createElement(m,e))}t.d(n,"default",function(){return u})},736:function(e,n,t){"use strict";t(46);var a=t(737),r=t(0),i=t.n(r),o=t(2),s=t.n(o),l=t(747),c=t.n(l),m=t(34);function p(e){var n=e.description,t=e.lang,r=e.meta,o=e.keywords,s=e.title;return i.a.createElement(m.b,{query:u,render:function(e){return"string"==typeof o&&(o=o.split(",").map(function(e){return e.trim()})),n=n||e.site.siteMetadata.description,i.a.createElement(c.a,{htmlAttributes:{lang:t},title:s,titleTemplate:"%s | "+e.site.siteMetadata.project,meta:[{name:"description",content:n},{property:"og:title",content:s},{property:"og:description",content:n},{property:"og:type",content:"website"},{name:"twitter:card",content:"summary"},{name:"twitter:creator",content:e.site.siteMetadata.author},{name:"twitter:title",content:s},{name:"twitter:description",content:n}].concat(o?{name:"keywords",content:o.join(", ")}:[]).concat(r)})},data:a})}p.defaultProps={lang:"en",meta:[],keywords:null},p.propTypes={description:s.a.string,lang:s.a.string,meta:s.a.array,keywords:s.a.oneOfType([s.a.string,s.a.arrayOf(s.a.string)]),title:s.a.string.isRequired},n.a=p;var u="304502870"},737:function(e){e.exports={data:{site:{siteMetadata:{project:"ACT blog",description:"React, Ant Design, Gatsby, GraphQl, and other web technologies",author:"Act Labs"}}}}},738:function(e,n,t){"use strict";t.d(n,"a",function(){return c});t(352);var a=t(739),r=t(0),i=t.n(r),o=t(34),s=t(231),l=t.n(s);function c(){return i.a.createElement(o.b,{query:"2369744027",render:function(e){return i.a.createElement(l.a,{fixed:e.logo.childImageSharp.fixed,style:{float:"left"}})},data:a})}},739:function(e){e.exports={data:{logo:{childImageSharp:{fixed:{base64:"data:image/png;base64,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",width:50,height:60,src:"/static/a64620346ac3ce8d4580a3f07039fa3c/8469d/logo.png",srcSet:"/static/a64620346ac3ce8d4580a3f07039fa3c/8469d/logo.png 1x"}}}}}},740:function(e){e.exports={data:{config:{copyright:"Copyright © Act Labs",social:[{icon:"facebook",link:"https://www.facebook.com/ACT7LAB"},{icon:"github",link:"https://github.com/act-labs/gatsby-starter-act-blog"}]}}}},741:function(e){e.exports={data:{config:{nav:[{text:"home",slug:null},{text:"posts",slug:"/posts/"},{text:"snippets",slug:"/snippets/"}]}}}},742:function(e,n,t){"use strict";t(6);var a=t(138),r=(t(178),t(31)),i=t.n(r),o=(t(748),t(734),t(735)),s=t.n(o),l=t(740),c=t(0),m=t.n(c),p=t(34),u=s.a.Footer;function d(e){var n=e.social,t=e.copyright,r=n.map(function(e){var n=e.link,t=e.icon;return m.a.createElement(a.a,{key:t,to:n},m.a.createElement(i.a,{type:t,style:{fontSize:"24px",marginLeft:10,color:"rgba(0, 0, 0, 0.65)"}}))});return m.a.createElement(u,{style:{textAlign:"center"}},m.a.createElement("div",null,t,m.a.createElement("div",{style:{float:"right"}},r)))}function g(e){return e.social?m.a.createElement(d,e):m.a.createElement(p.b,{query:"2743462859",render:function(n){var t=n.config,a=t.social,r=t.copyright;return m.a.createElement(d,Object.assign({social:a,copyright:r},e))},data:l})}t(746);var h=t(745),y=t.n(h),b=t(738),f=t(741),k=s.a.Header;function E(e){var n=e.nav;return m.a.createElement(k,{className:"navigation-bar"},m.a.createElement(a.a,{to:"/"},m.a.createElement(b.a,null)),m.a.createElement(y.a,{theme:"dark",mode:"horizontal",defaultSelectedKeys:n.filter(function(e){return e.selected}).map(function(e){return e.text}),style:{lineHeight:"64px"}},n.map(function(e,n){var t=e.slug,r=e.text;return m.a.createElement(y.a.Item,{key:n},m.a.createElement(a.a,{to:t||"/"},r))})))}function v(e){return e.nav?m.a.createElement(E,e):m.a.createElement(p.b,{query:"1250442554",render:function(n){var t=n.config.nav;return m.a.createElement(E,Object.assign({nav:t},e))},data:f})}var T=t(736),D=t(14),A=t.n(D);t(671);t.d(n,"a",function(){return C});var M=s.a.Content,w=s.a.Sider;function X(e){var n=e.style,t=e.children,a=A()(e,["style","children"]);return m.a.createElement(M,Object.assign({style:Object.assign({padding:"5px 24px"},n)},a),t)}function C(e){var n=e.children,t=e.className,a=e.title,r=e.description,i=e.keywords,o=e.style,l=e.layout,c=Object.assign({},N,l),p=c.footer,u=c.fullHeight,d=Object.assign({},u?{height:"100%"}:null,o),h=(t?t+" ":"")+"page-layout";return m.a.createElement(s.a,{className:h,style:d},m.a.createElement(T.a,{title:a,keywords:i,description:r}),m.a.createElement(v,null),n,p?m.a.createElement(g,null):null)}var N={footer:!0};C.Panel=X,C.SideMenuPanel=function(e){var n=e.children,t=e.menu;return m.a.createElement(s.a,{style:{padding:"1em 0",background:"#fff",minHeight:1e3}},m.a.createElement(w,{width:200},t),m.a.createElement(X,null,n))}},744:function(e,n,t){"use strict";t(6);var a=t(138),r=(t(46),t(0)),i=t.n(r),o=t(890),s=t(750),l=t(751),c=t(752),m=t(753),p=t(754),u=t(755);o.a.registerLanguage("javascript",s.a),o.a.registerLanguage("sh",l.a),o.a.registerLanguage("markdown",c.a),o.a.registerLanguage("yaml",m.a),o.a.registerLanguage("dockerfile",p.a);var d=t(1);t.d(n,"a",function(){return h});var g={components:{code:function(e){var n="bash";if(e.className){var t=e.className.split("-");t.length>1&&(n=t[1])}return i.a.createElement(o.a,{language:n,style:u.github},e.children)},a:a.a}};function h(e){var n=Object.assign({},g,e),t=n.components,a=n.children;return i.a.createElement(d.MDXProvider,{components:t},a)}},756:function(e,n,t){"use strict";t.d(n,"a",function(){return l});var a=t(744),r=(t(6),t(742)),i=t(0),o=t.n(i),s=(t(672),r.a.Panel);function l(e){var n=e.children,t=e.pageContext,i=Object.assign({frontmatter:{}},t),l=Object.assign({},{layout:i.layout},i.frontmatter);return o.a.createElement(r.a,l,o.a.createElement(s,{style:{paddingTop:"1em"}},l.title?o.a.createElement("h1",null,l.title):null,o.a.createElement(a.a,null,n)))}}}]);
//# sourceMappingURL=component---src-generated-posts-jenkins-k-8-s-js-0f7ef8e3d08a4c0cb7a1.js.map