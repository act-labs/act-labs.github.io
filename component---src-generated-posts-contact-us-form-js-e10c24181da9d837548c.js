(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{727:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(14),s=n.n(o),i=n(15),c=n.n(i),l=n(1),m=function(e){function t(t){var n;return(n=e.call(this,t)||this).layout=null,n}return c()(t,e),t.prototype.render=function(){var e=this.props,t=e.components;s()(e,["components"]);return r.a.createElement(l.MDXTag,{name:"wrapper",components:t},r.a.createElement(l.MDXTag,{name:"p",components:t},"Lets create simple form using TDD and Jest. Now when ",r.a.createElement(l.MDXTag,{name:"a",components:t,parentName:"p",props:{href:"/posts/form-components/",title:"Simple form implementation from scratch"}},"Form components")," are available we may pay attention to our application logic (validation and communication with server). Later we consider ",r.a.createElement(l.MDXTag,{name:"a",components:t,parentName:"p",props:{href:"/posts/mysql-express/",title:"Express and MySql. Simple Contact Us form"}},"server side implementation")," which uses Express and MySQL. Source code could be found in ",r.a.createElement(l.MDXTag,{name:"a",components:t,parentName:"p",props:{href:"https://github.com/act-labs/contact-us",title:"Sample contact-us app using React/MySql/Express"}},"Github repository"),"."),r.a.createElement(l.MDXTag,{name:"h2",components:t},"Simple contact us form"),r.a.createElement(l.MDXTag,{name:"p",components:t},"Here we create simple form to add messages from users along with their contact details. We pay little attention to the form design (which later could be tweaked through CSS styles). Our main focus is functionality: validation and communication with server."),r.a.createElement(l.MDXTag,{name:"pre",components:t},r.a.createElement(l.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-javascript"}},'const App = () => {\n  const counter = useRef(0)\n  const [last, setLast] = useState(WAIT_MESSAGE)\n\n  const nextRequest = async (request) => {\n    const current = ++counter.current\n    setLast(WAIT_MESSAGE)\n    let message\n    try {\n      const res = await request()\n      const data = (res.ok && await res.json()) || { message: `Error code ${res.status}: ${res.statusText}` }\n      message = data.message\n    } catch (e) {\n      message = String(e)\n    }\n\n    if (current !== counter.current) {\n      return\n    }\n    setLast(message)\n  }\n\n  useEffect(() => {\n    nextRequest(() => fetch("http://localhost:8080/"))\n    return () => counter.current = Infinity\n  }, [])\n\n  const onSubmit = async (value) => {\n    await nextRequest(() => fetch("http://localhost:8080/contacts", {\n      method: \'POST\',\n      headers: {\n        \'Accept\': \'application/json\',\n        \'Content-Type\': \'application/json\'\n      },\n      body: JSON.stringify(value)\n    }))\n  }\n\n  return (\n    <div className="App">\n      <header className="App-header">\n        <h1>Contact Us</h1>\n        <p>{last}</p>\n\n        <Form onSubmit={onSubmit}>\n          <Field label={"First name"} name="first_name" required>{({ fieldProps }) => <TextField {...fieldProps} />}</Field>\n          <Field label={"Last name"} name="last_name">{({ fieldProps }) => <TextField {...fieldProps} />}</Field>\n          <Field label={"Address"} name="address" >{({ fieldProps }) => <TextField {...fieldProps} />}</Field>\n          <Field label={"Phone"} name="phone">{({ fieldProps }) => <TextField {...fieldProps} />}</Field>\n          <Field label={"Email"} name="email" required email>{({ fieldProps }) => <TextField {...fieldProps} />}</Field>\n          <Field label={"Message"} name="message" required>{({ fieldProps }) => <Textarea {...fieldProps} />}</Field>\n          <input type="submit" value="Submit" />\n        </Form>\n      </header>\n    </div>\n  )\n}\n')),r.a.createElement(l.MDXTag,{name:"p",components:t},"Here we send POST and GET requests to the server using ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:t,parentName:"p"},"fetch")," function. We display the status of the last communication with the server using ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:t,parentName:"p"},"const [last, setLast] = useState(WAIT_MESSAGE)")," state variable, handle stale replies using counter (",r.a.createElement(l.MDXTag,{name:"inlineCode",components:t,parentName:"p"},"const counter = useRef(0)"),"), and protect from React ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:t,parentName:"p"},"useState")," updates for unmounted components using ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:t,parentName:"p"},"useEffect")," clean up (",r.a.createElement(l.MDXTag,{name:"inlineCode",components:t,parentName:"p"},"return () => counter.current = Infinity"),")."),r.a.createElement(l.MDXTag,{name:"h2",components:t},"Jest, mocking fetch function"),r.a.createElement(l.MDXTag,{name:"p",components:t},"We approach our component testing using BDD style testing. First we need to compile the most important user stories. Users should see\nlast request status (both in case of success and failures). Form should validate fields (displaying error messages). And, finally, form should send valid requests to the server. As we do not want make our development workflow dependent on server implementation, we need to stub ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:t,parentName:"p"},"fetch")," requests. Which is, luckily quite simple. For example, to mock successful server replies we may create simple helper function:"),r.a.createElement(l.MDXTag,{name:"pre",components:t},r.a.createElement(l.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-javascript"}},"const mockFetch = (response) => {\n  const mockResponseData = response\n\n  const mockJsonPromise = Promise.resolve(mockResponseData)\n  const mockResponsePromise = Promise.resolve({\n    ok: true,\n    json: () => mockJsonPromise,\n  })\n\n  jest.spyOn(global, 'fetch').mockImplementation(() => mockResponsePromise)\n}\n")),r.a.createElement(l.MDXTag,{name:"p",components:t},"As call to fetch returns Promise, resolving to response with ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:t,parentName:"p"},"ok")," flag to test the success, and asynchronous functions to fetch data, two Promise objects are used. The jest ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:t,parentName:"p"},"spyOn")," function is used to mock global ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:t,parentName:"p"},"fetch")," function (",r.a.createElement(l.MDXTag,{name:"inlineCode",components:t,parentName:"p"},"jest.spyOn(global, 'fetch').mockImplementation(() => mockResponsePromise)"),"). Mocking fetch failures is even simpler one-liner:"),r.a.createElement(l.MDXTag,{name:"pre",components:t},r.a.createElement(l.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-javascript"}},"jest.spyOn(global, 'fetch').mockImplementation(() => { throw new Error(\"Some error\") })\n")),r.a.createElement(l.MDXTag,{name:"p",components:t},"Using our helper, testing first scenarios is quite simple:"),r.a.createElement(l.MDXTag,{name:"pre",components:t},r.a.createElement(l.MDXTag,{name:"code",components:t,parentName:"pre",props:{className:"language-javascript"}},"describe(\"user opens contact us\", () => {\n  it('API is active', async () => {\n    await act(async () => {\n      mockFetch({\n        message: 'API Active'\n      })\n\n      const { getByText } = render(<App />)\n\n      await waitForElement(() => getByText(/API Active/i))\n      expect(global.fetch.mock.calls.length).toBe(1)\n      global.fetch.mockRestore()\n    })\n  })\n\n  it('API failure', async () => {\n    await act(async () => {\n      jest.spyOn(global, 'fetch').mockImplementation(() => { throw new Error(\"Some error\") })\n      const { getByText } = render(<App />)\n\n      await waitForElement(() => getByText(/Error: Some error/i))\n      expect(global.fetch.mock.calls.length).toBe(1)\n      global.fetch.mockRestore()\n    })\n  })\n})\n")),r.a.createElement(l.MDXTag,{name:"p",components:t},"We start our tests from mocking, and restore state of the mock on exit. A popular ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:t,parentName:"p"},"@testing-library/react")," library is used to avoid unnecessary tight coupling between tests and application. As our component is updated asynchronously, we wrap tests in ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:t,parentName:"p"},"await act(async () => {...})")," functions, and wait waiting for UI updates using ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:t,parentName:"p"},"await waitForElement(() => ...)")," wrappers."),r.a.createElement(l.MDXTag,{name:"h2",components:t},"Next"),r.a.createElement(l.MDXTag,{name:"p",components:t},"Now, when the main functionality, is tested we may look at server side implementation."))},t}(r.a.Component),p=n(753);function u(e){return r.a.createElement(p.a,e,r.a.createElement(m,e))}n.d(t,"default",function(){return u})},732:function(e,t,n){"use strict";n(46);var a=n(733),r=n(0),o=n.n(r),s=n(2),i=n.n(s),c=n(744),l=n.n(c),m=n(34);function p(e){var t=e.description,n=e.lang,r=e.meta,s=e.keywords,i=e.title;return o.a.createElement(m.b,{query:u,render:function(e){return"string"==typeof s&&(s=s.split(",").map(function(e){return e.trim()})),t=t||e.site.siteMetadata.description,o.a.createElement(l.a,{htmlAttributes:{lang:n},title:i,titleTemplate:"%s | "+e.site.siteMetadata.project,meta:[{name:"description",content:t},{property:"og:title",content:i},{property:"og:description",content:t},{property:"og:type",content:"website"},{name:"twitter:card",content:"summary"},{name:"twitter:creator",content:e.site.siteMetadata.author},{name:"twitter:title",content:i},{name:"twitter:description",content:t}].concat(s?{name:"keywords",content:s.join(", ")}:[]).concat(r)})},data:a})}p.defaultProps={lang:"en",meta:[],keywords:null},p.propTypes={description:i.a.string,lang:i.a.string,meta:i.a.array,keywords:i.a.oneOfType([i.a.string,i.a.arrayOf(i.a.string)]),title:i.a.string.isRequired},t.a=p;var u="304502870"},733:function(e){e.exports={data:{site:{siteMetadata:{project:"ACT blog",description:"React, Ant Design, Gatsby, GraphQl, and other web technologies",author:"Act Labs"}}}}},734:function(e,t,n){"use strict";n.d(t,"a",function(){return l});n(352);var a=n(735),r=n(0),o=n.n(r),s=n(34),i=n(231),c=n.n(i);function l(){return o.a.createElement(s.b,{query:"2369744027",render:function(e){return o.a.createElement(c.a,{fixed:e.logo.childImageSharp.fixed,style:{float:"left"}})},data:a})}},735:function(e){e.exports={data:{logo:{childImageSharp:{fixed:{base64:"data:image/png;base64,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",width:50,height:60,src:"/static/a64620346ac3ce8d4580a3f07039fa3c/8469d/logo.png",srcSet:"/static/a64620346ac3ce8d4580a3f07039fa3c/8469d/logo.png 1x"}}}}}},736:function(e){e.exports={data:{config:{copyright:"Copyright © Act Labs",social:[{icon:"facebook",link:"https://www.facebook.com/ACT7LAB"},{icon:"github",link:"https://github.com/act-labs/gatsby-starter-act-blog"}]}}}},737:function(e){e.exports={data:{config:{nav:[{text:"home",slug:null},{text:"posts",slug:"/posts/"},{text:"snippets",slug:"/snippets/"}]}}}},738:function(e,t,n){"use strict";n(6);var a=n(138),r=(n(178),n(31)),o=n.n(r),s=(n(745),n(730),n(731)),i=n.n(s),c=n(736),l=n(0),m=n.n(l),p=n(34),u=i.a.Footer;function d(e){var t=e.social,n=e.copyright,r=t.map(function(e){var t=e.link,n=e.icon;return m.a.createElement(a.a,{key:n,to:t},m.a.createElement(o.a,{type:n,style:{fontSize:"24px",marginLeft:10,color:"rgba(0, 0, 0, 0.65)"}}))});return m.a.createElement(u,{style:{textAlign:"center"}},m.a.createElement("div",null,n,m.a.createElement("div",{style:{float:"right"}},r)))}function g(e){return e.social?m.a.createElement(d,e):m.a.createElement(p.b,{query:"2743462859",render:function(t){var n=t.config,a=n.social,r=n.copyright;return m.a.createElement(d,Object.assign({social:a,copyright:r},e))},data:c})}n(742);var f=n(741),h=n.n(f),y=n(734),E=n(737),b=i.a.Header;function v(e){var t=e.nav;return m.a.createElement(b,{className:"navigation-bar"},m.a.createElement(a.a,{to:"/"},m.a.createElement(y.a,null)),m.a.createElement(h.a,{theme:"dark",mode:"horizontal",defaultSelectedKeys:t.filter(function(e){return e.selected}).map(function(e){return e.text}),style:{lineHeight:"64px"}},t.map(function(e,t){var n=e.slug,r=e.text;return m.a.createElement(h.a.Item,{key:t},m.a.createElement(a.a,{to:n||"/"},r))})))}function w(e){return e.nav?m.a.createElement(v,e):m.a.createElement(p.b,{query:"1250442554",render:function(t){var n=t.config.nav;return m.a.createElement(v,Object.assign({nav:n},e))},data:E})}var A=n(732),T=n(14),M=n.n(T);n(671);n.d(t,"a",function(){return x});var k=i.a.Content,D=i.a.Sider;function X(e){var t=e.style,n=e.children,a=M()(e,["style","children"]);return m.a.createElement(k,Object.assign({style:Object.assign({padding:"5px 24px"},t)},a),n)}function x(e){var t=e.children,n=e.className,a=e.title,r=e.description,o=e.keywords,s=e.style,c=e.layout,l=Object.assign({},N,c),p=l.footer,u=l.fullHeight,d=Object.assign({},u?{height:"100%"}:null,s),f=(n?n+" ":"")+"page-layout";return m.a.createElement(i.a,{className:f,style:d},m.a.createElement(A.a,{title:a,keywords:o,description:r}),m.a.createElement(w,null),t,p?m.a.createElement(g,null):null)}var N={footer:!0};x.Panel=X,x.SideMenuPanel=function(e){var t=e.children,n=e.menu;return m.a.createElement(i.a,{style:{padding:"1em 0",background:"#fff",minHeight:1e3}},m.a.createElement(D,{width:200},n),m.a.createElement(X,null,t))}},740:function(e,t,n){"use strict";n(6);var a=n(138),r=(n(46),n(0)),o=n.n(r),s=n(884),i=n(746),c=n(747),l=n(748),m=n(749),p=n(750),u=n(751);s.a.registerLanguage("javascript",i.a),s.a.registerLanguage("sh",c.a),s.a.registerLanguage("markdown",l.a),s.a.registerLanguage("yaml",m.a),s.a.registerLanguage("dockerfile",p.a);var d=n(1);n.d(t,"a",function(){return f});var g={components:{code:function(e){var t="bash";if(e.className){var n=e.className.split("-");n.length>1&&(t=n[1])}return o.a.createElement(s.a,{language:t,style:u.github},e.children)},a:a.a}};function f(e){var t=Object.assign({},g,e),n=t.components,a=t.children;return o.a.createElement(d.MDXProvider,{components:n},a)}},753:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var a=n(740),r=(n(6),n(738)),o=n(0),s=n.n(o),i=(n(672),r.a.Panel);function c(e){var t=e.children,n=e.pageContext,o=Object.assign({frontmatter:{}},n),c=Object.assign({},{layout:o.layout},o.frontmatter);return s.a.createElement(r.a,c,s.a.createElement(i,{style:{paddingTop:"1em"}},c.title?s.a.createElement("h1",null,c.title):null,s.a.createElement(a.a,null,t)))}}}]);
//# sourceMappingURL=component---src-generated-posts-contact-us-form-js-e10c24181da9d837548c.js.map